## ENCE 3210 – Lab 3
### Timers, Interrupts, and Concurrent Tasks on Arduino

### The objective is to demonstrate the use of hardware timers, interrupt service routines (ISRs), GPIO, and volatile variables to run multiple tasks concurrently on an embedded system



## Project Overview

The program runs two background tasks using hardware timers and one foreground task in the main loop:

Task 1 (Timer1 @ 1 Hz)
Blinks a green LED at 1 Hz and increments a counter used as a system timer.

Task 2 (Timer2 @ 10 Hz)
Periodically reads a pushbutton input and controls a red LED.

Foreground Task (Main Loop)
Prints a message over the serial port every 3 seconds using the counter generated by Task 1.

This design avoids blocking delays and demonstrates true concurrency using interrupts.



## The Hardware I Used :

Microcontroller: Arduino (with Kitchen Timer shield)

Language: C (Arduino framework)


## How to check if my code works 

Green LED blinks once per second
Red LED turns ON only while the button is pressed
Serial Monitor prints a message every 3 seconds
All tasks run simultaneously without delays



## My code 

``` C

/* 
   Pin Definitions
   */
#define GREEN_LED 4     // Green LED controlled by Task 1
#define RED_LED   5     // Red LED controlled by Task 2
#define BUTTON    2     // Button input (active-HIGH)

/* 
   Global Variables
   
   These variables are accessed inside ISRs and the main loop,
   so they must be declared volatile to prevent compiler
   optimization issues.
*/
volatile unsigned long gSeconds = 0;   // Counts seconds (Task 1)
volatile unsigned char gTick10Hz = 0;  // Used to scale Timer2 rate

unsigned long lastPrint = 0;            // Used by main task timing

/* 
   Setup Function
   Configures GPIO, serial communication, and hardware timers.
*/
void setup() {

  /* Configure GPIO pins */
  pinMode(GREEN_LED, OUTPUT);
  pinMode(RED_LED, OUTPUT);
  pinMode(BUTTON, INPUT);     // Button is active-HIGH on this board

  /* Initialize serial communication */
  Serial.begin(9600);

  /* Disable global interrupts while configuring timers */
  cli();

  /*
     Timer1 Configuration
     Task 1 – 1 Hz
   
     - 16-bit timer
     - CTC mode
     - Prescaler: 256
     - Interrupt every 1 second
  */
  TCCR1A = 0;
  TCCR1B = 0;
  TCNT1  = 0;

  OCR1A = 62499;              // Compare value for 1 Hz
  TCCR1B |= (1 << WGM12);     // CTC mode
  TCCR1B |= (1 << CS12);      // Prescaler = 256
  TIMSK1 |= (1 << OCIE1A);    // Enable Timer1 interrupt

  /* 
     Timer2 Configuration
     Task 2 – 10 Hz
    
     - 8-bit timer
     - CTC mode
     - Prescaler: 1024
     - Interrupt rate divided in software
  */
  TCCR2A = 0;
  TCCR2B = 0;
  TCNT2  = 0;

  OCR2A = 155;
  TCCR2A |= (1 << WGM21);                     // CTC mode
  TCCR2B |= (1 << CS22) | (1 << CS21) | (1 << CS20); // Prescaler = 1024
  TIMSK2 |= (1 << OCIE2A);                    // Enable Timer2 interrupt

  /* Re-enable global interrupts */
  sei();
}

/*
   TASK 1 – Timer1 Interrupt Service Routine (1 Hz)
   
   - Toggles the Green LED every second
   - Increments a global seconds counter
*/
ISR(TIMER1_COMPA_vect) {
  static unsigned char state = 0;

  state ^= 1;                         // Toggle LED state
  digitalWrite(GREEN_LED, state);     // Blink Green LED

  gSeconds++;                         // Increment 1-second counter
}

/*
   TASK 2 – Timer2 Interrupt Service Routine (10 Hz)
 
   - Periodically reads the button input
   - Turns Red LED ON when button is pressed
   - Turns Red LED OFF otherwise
*/
ISR(TIMER2_COMPA_vect) {
  gTick10Hz++;

  /* Reduce faster Timer2 interrupts to ~10 Hz */
  if (gTick10Hz >= 10) {
    gTick10Hz = 0;

    if (digitalRead(BUTTON) == HIGH)
      digitalWrite(RED_LED, HIGH);
    else
      digitalWrite(RED_LED, LOW);
  }
}

/* 
   FOREGROUND TASK – Main Loop
 
   - Executes continuously
   - Prints a message every 3 seconds
   - Uses gSeconds counter from Task 1
*/
void loop() {
  unsigned long now;

  /* Safely read shared variable */
  cli();
  now = gSeconds;
  sei();

  if (now - lastPrint >= 3) {
    lastPrint = now;
    Serial.println("Lab 3 running: 3 seconds elapsed");
  }
}
```

